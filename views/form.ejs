<%- include('partials/header') %>

<div class="card">
    <h2>表单交互示例</h2>
    <p>自动化测试挑战：</p>
    <ul>
        <li>输入合法和非法数据。</li>
        <li>验证错误提示信息。</li>
        <li>提交表单并验证成功响应（异步提交）。</li>
    </ul>

    <form id="testForm">
        <div class="form-group">
            <label for="username">用户名 (Username):</label>
            <input type="text" id="username" name="username" placeholder="请输入用户名" required>
        </div>
        <div class="form-group">
            <label for="email">邮箱 (Email):</label>
            <input type="email" id="email" name="email" placeholder="请输入邮箱" required>
        </div>
        <button type="submit" class="btn" id="submitBtn">提交</button>
    </form>

    <div id="resultMessage" style="margin-top: 20px; padding: 10px; display: none;"></div>
</div>

<script>
    document.getElementById('testForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const resultDiv = document.getElementById('resultMessage');
        const submitBtn = document.getElementById('submitBtn');

        // Disable button to simulate loading
        submitBtn.disabled = true;
        submitBtn.innerText = '提交中...';
        resultDiv.style.display = 'none';

        fetch('/api/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, email }),
        })
        .then(response => response.json())
        .then(data => {
            resultDiv.style.display = 'block';
            if (data.success) {
                resultDiv.style.backgroundColor = '#d4edda';
                resultDiv.style.color = '#155724';
                resultDiv.innerText = data.message;
            } else {
                resultDiv.style.backgroundColor = '#f8d7da';
                resultDiv.style.color = '#721c24';
                resultDiv.innerText = data.message;
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            resultDiv.style.display = 'block';
            resultDiv.style.backgroundColor = '#f8d7da';
            resultDiv.style.color = '#721c24';
            resultDiv.innerText = '发生网络错误';
        })
        .finally(() => {
            submitBtn.disabled = false;
            submitBtn.innerText = '提交';
        });
    });
</script>

<%- include('partials/footer') %>
